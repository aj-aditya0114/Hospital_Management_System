<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Records</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #e3f2fd, #f1f8e9);
            font-family: 'Segoe UI', sans-serif;
        }
        .record-card {
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: 0.3s;
        }
        .record-card:hover {
            transform: scale(1.03);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        .search-box {
            max-width: 400px;
            margin: auto;
        }
    </style>
</head>
<body>

<div class="container py-5">
    <h2 class="text-center text-primary mb-4">üìÅ My Medical Records</h2>

    <!-- Search Box -->
    <div class="search-box mb-4">
        <input type="text" id="searchInput" class="form-control" placeholder="Search by doctor, date, or disease...">
		<button type="submit" class="btn btn-primary mt-2">Search</button>
    </div>
	
	<div id="searchResults" class="mb-4 text-primary fw-bold"></div>

    <div class="row g-4" id="recordscontainer">
		<div th:each="record, iterStat : ${records}" class="col-md-4 record-item">
			<div class=""card record-card p-3>
				<h5 class="card-title text-success" th:text="${record.doctorName}"></h5>
				<p class="card-text">Disease: <span th:text="${record.disease}"></span></p>
				<p class="card-text"><small class="text-muted">Date: <span th:text="${record.date}"></span></small></p>
				<button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal"
					th:attr="data-bs-target='#recordModal' + ${iterStat.index}">
					View Details
				</button>
			</div>
			
		</div>
	</div>

<script>
document.getElementById("searchInput").addEventListener("keyup", function () {
    let filter = this.value.toLowerCase();
    let records = document.getElementsByClassName("record-item");
    let resultsDiv = document.getElementById("searchResults");

    resultsDiv.innerHTML = ""; // clear old results

    if (filter.trim() === "") {
        // If nothing typed, reset view
        for (let i = 0; i < records.length; i++) {
            records[i].style.display = "";
        }
        return;
    }

    let found = [];

    for (let i = 0; i < records.length; i++) {
        let doctorName = records[i].querySelector(".card-title").innerText;
        let date = records[i].querySelector(".text-muted").innerText;
        let text = records[i].innerText.toLowerCase();

        if (text.includes(filter)) {
            records[i].style.display = ""; // keep visible
            found.push(doctorName + " (" + date + ")");
        } else {
            records[i].style.display = "none";
        }
    }

    if (found.length > 0) {
        resultsDiv.innerHTML = "üîç Found: " + found.join(", ");
    } else {
        resultsDiv.innerHTML = "‚ùå No records found";
    }
});

</script>
</body>
</html>
